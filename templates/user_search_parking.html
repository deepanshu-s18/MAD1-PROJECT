{% extends 'index.html' %}

{% block title %} Search Parking {% endblock %} {# Specific title for the user parking search page #}

{% block content %}
<div class="container mt-5"> {# Use 'container' for standard width and add top margin #}
    <div class="row justify-content-center mb-4">
        <div class="col-lg-8 col-md-10"> {# Adjusted column width for better centering and responsiveness #}
            <h3 class="text-center mb-4">Find Parking Zones</h3>
            <form class="d-flex" action="{{ url_for('user_parking_search') }}" method="post"> {# Updated action URL #}
                <div class="input-group">
                    <input type="text" class="form-control form-control-lg" placeholder="Search by Location or Pin Code" name="search_query" required> {# Renamed search_parking to search_query, added form-control-lg #}
                    <button type="submit" class="btn btn-primary btn-lg">Search</button> {# Changed to btn-primary, btn-lg #}
                </div>
            </form>
            <p class="text-muted text-center mt-2"><i>Enter a location name or a pin code.</i></p>
        </div>
    </div>

    {% if search_performed and not results %} {# Check if a search was performed but yielded no results #}
        <div class="alert alert-info text-center mt-4" role="alert">
            No parking zones found matching your search. Try a different term.
        </div>
    {% elif results %} {# Display results only if there are any #}
        <hr class="my-5"> {# Separator #}
        <h4 class="text-center mb-4"><i class="bi bi-search me-2"></i>Search Results</h4> {# Icon and heading #}
        <div class="table-responsive"> {# Make table responsive for smaller screens #}
            <table class="table table-striped table-bordered table-hover align-middle"> {# Added table-hover and align-middle #}
                <thead class="table-dark"> {# Style the table header #}
                    <tr>
                        <th>ID</th>
                        <th>Location</th>
                        <th>Address</th> {# Added Address column #}
                        <th>Pin Code</th>
                        <th>Hourly Price</th> {# Changed Max Spots to Hourly Price #}
                        <th>Total Spots</th> {# Changed Max Spots to Total Spots #}
                        <th>Available Spots</th>
                        <th>Occupied Spots</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody>
                    {% for parking_zone in results %} {# Renamed result to parking_zone #}
                    <tr>
                        <td>{{ parking_zone.id }}</td>
                        <td>{{ parking_zone.location }}</td>
                        <td>{{ parking_zone.address }}</td> {# Display address #}
                        <td>{{ parking_zone.pin_code }}</td>
                        <td>â‚¹{{ parking_zone.price }}</td> {# Display hourly price #}
                        <td>{{ parking_zone.max_spots }}</td> {# Display total spots #}
                        {# Assuming lot_bundles is now zone_data and aligned by loop.index0 #}
                        <td>{{ zone_data[loop.index0].available_spots|length }}</td> {# Updated variable name #}
                        <td>{{ zone_data[loop.index0].occupied_spots|length }}</td> {# Updated variable name #}
                        <td>
                            <a href="{{ url_for('view_parking_zone_details', zone_id=parking_zone.id) }}" class="btn btn-primary btn-sm">View Details</a> {# Changed button to link, updated URL #}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    {% endif %}

</div>
{% endblock %}